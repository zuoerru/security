<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>悬浮窗口功能最终集成测试</title>
    <!-- 引入与实际应用相同的外部资源 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* 模拟应用的侧边栏样式 */
        .sidebar {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 100;
            width: 200px;
            background-color: #f8f9fa;
            padding: 1rem;
            box-shadow: 1px 0 3px rgba(0, 0, 0, 0.1);
        }
        
        /* 模拟应用的主内容区域 */
        main {
            margin-left: 220px;
            padding: 1rem;
        }
        
        /* 测试按钮样式 */
        .test-controls {
            margin: 2rem 0;
            padding: 1rem;
            background-color: #f0f0f0;
            border-radius: 8px;
        }
        
        /* 悬浮窗口的样式 - 使用与应用相同的类名和高优先级样式 */
        #logs-modal {
            position: fixed !important;
            top: 10px !important;
            right: 10px !important;
            width: 320px !important;
            max-height: 400px !important;
            background-color: white !important;
            border: 1px solid #ddd !important;
            border-radius: 8px !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
            z-index: 9999 !important;
            display: none !important;
            overflow: hidden !important;
        }
        
        .window-header {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f5f5f5;
        }
        
        .window-content {
            padding: 15px;
            max-height: 280px;
            overflow-y: auto;
        }
        
        .window-footer {
            padding: 10px 15px;
            border-top: 1px solid #eee;
            text-align: right;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- 模拟应用的侧边栏 -->
    <div class="sidebar">
        <h2 class="h5 mb-4">安全管理系统</h2>
        <ul class="nav flex-column">
            <li class="nav-item mb-2">
                <a class="nav-link active" href="#">首页</a>
            </li>
            <li class="nav-item mb-2">
                <a class="nav-link" href="#">CVE</a>
            </li>
            <li class="nav-item mb-2">
                <a class="nav-link" href="#">NESSUS</a>
            </li>
            <li class="nav-item mb-2">
                <a class="nav-link" href="#">NVD</a>
            </li>
        </ul>
    </div>

    <!-- 主内容区域 -->
    <main>
        <div class="test-controls">
            <h1>悬浮窗口功能最终集成测试</h1>
            <p>这个测试页面模拟了实际应用环境，包含侧边栏、主内容区域和悬浮窗口。点击下方按钮测试悬浮窗口功能：</p>
            <button id="view-logs-btn" class="btn btn-primary">查看同步日志（模拟应用按钮）</button>
            <button id="direct-show-btn" class="btn btn-secondary ml-2">直接显示悬浮窗口</button>
            <button id="reset-btn" class="btn btn-warning ml-2">重置测试</button>
        </div>

        <!-- 模拟应用的内容 -->
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">NVD 漏洞数据库</div>
                        <div class="card-body">
                            <p>这里是应用的主要内容区域，包含漏洞数据表格等信息。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 悬浮窗口 - 与实际应用完全相同的结构 -->
    <div id="logs-modal" style="position: fixed !important; top: 10px !important; right: 10px !important; z-index: 9999 !important; display: none !important;">
        <div class="window-header">
            <h3 style="margin: 0; font-size: 16px; font-weight: bold;">同步日志</h3>
            <button id="close-logs-btn" class="close-btn">×</button>
        </div>
        <div id="logs-content" class="window-content">
            <div style="margin-bottom: 8px; color: #333;">[2025-10-14 08:30:12] 开始同步NVD数据</div>
            <div style="margin-bottom: 8px; color: #008000;">[2025-10-14 08:30:15] NVD数据同步成功</div>
            <div style="margin-bottom: 8px; color: #333;">[2025-10-14 08:30:16] 开始同步CISA数据</div>
            <div style="margin-bottom: 8px; color: #008000;">[2025-10-14 08:30:20] CISA数据同步成功</div>
            <div style="margin-bottom: 8px; color: #333;">[2025-10-14 08:30:21] 开始同步Nessus数据</div>
            <div style="margin-bottom: 8px; color: #008000;">[2025-10-14 08:30:25] Nessus数据同步成功</div>
        </div>
        <div class="window-footer">
            <button id="confirm-close-logs-btn" class="btn btn-secondary btn-sm">关闭</button>
        </div>
    </div>

    <!-- 引入JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 等待DOM加载完成
        document.addEventListener('DOMContentLoaded', function() {
            const logsModal = document.getElementById('logs-modal');
            const viewLogsBtn = document.getElementById('view-logs-btn');
            const directShowBtn = document.getElementById('direct-show-btn');
            const resetBtn = document.getElementById('reset-btn');
            const closeLogsBtn = document.getElementById('close-logs-btn');
            const confirmCloseLogsBtn = document.getElementById('confirm-close-logs-btn');
            
            console.log('页面加载完成，开始初始化悬浮窗口功能');
            console.log('悬浮窗口元素:', logsModal);
            
            // 模拟应用中使用的显示窗口函数
            function showFloatWindow() {
                try {
                    console.log('尝试显示悬浮窗口');
                    
                    // 先移除hidden类
                    logsModal.classList.remove('hidden');
                    
                    // 强制设置所有关键样式
                    logsModal.style.display = 'block';
                    logsModal.style.position = 'fixed';
                    logsModal.style.top = '10px';
                    logsModal.style.right = '10px';
                    logsModal.style.zIndex = '9999';
                    
                    console.log('悬浮窗口显示成功! 当前样式:', {
                        display: logsModal.style.display,
                        position: logsModal.style.position,
                        top: logsModal.style.top,
                        right: logsModal.style.right,
                        zIndex: logsModal.style.zIndex
                    });
                } catch (error) {
                    console.error('显示悬浮窗口失败:', error);
                    alert('显示悬浮窗口失败: ' + error.message);
                }
            }
            
            // 隐藏窗口函数
            function hideFloatWindow() {
                try {
                    console.log('尝试隐藏悬浮窗口');
                    logsModal.classList.add('hidden');
                    logsModal.style.display = 'none';
                    console.log('悬浮窗口隐藏成功!');
                } catch (error) {
                    console.error('隐藏悬浮窗口失败:', error);
                }
            }
            
            // 重置测试
            function resetTest() {
                hideFloatWindow();
                console.log('测试已重置');
            }
            
            // 添加事件监听器
            viewLogsBtn.addEventListener('click', showFloatWindow);
            directShowBtn.addEventListener('click', showFloatWindow);
            resetBtn.addEventListener('click', resetTest);
            closeLogsBtn.addEventListener('click', hideFloatWindow);
            confirmCloseLogsBtn.addEventListener('click', hideFloatWindow);
            
            console.log('事件监听器添加完成');
        });
    </script>
</body>
</html>