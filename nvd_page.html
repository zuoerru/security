<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>安全管理系统</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- 自定义CSS -->
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 左侧导航栏 -->
            <nav class="col-md-2 d-none d-md-block bg-light sidebar">
                <div class="position-sticky">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="/">
                                <span data-feather="home"></span>
                                首页
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/cisa/">
                                <span data-feather="shield"></span>
                                CISA
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/cve/">
                                <span data-feather="alert-triangle"></span>
                                CVE
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/nessus/">
                                <span data-feather="search"></span>
                                NESSUS
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/nvd/">
                                <span data-feather="database"></span>
                                NVD
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- 主内容区域 -->
            <main class="col-md-10 ms-sm-auto px-4">
                <!-- 显示flash消息 -->
                
                    
                
                
                
    <!-- 引入NVD专用样式 -->
    <link href="/static/css/nvd-styles.css" rel="stylesheet">
    
    <!-- 顶部标题区域 - 使用渐变背景美化 -->
    <div class="page-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center px-4">
        <h1>NVD 漏洞数据库</h1>
    </div>

    <!-- 日志查看悬浮窗口 -->
    <div id="logs-modal" class="fixed top-4 right-4 w-80 max-h-[70vh] bg-white rounded-lg shadow-xl z-1000 hidden border border-gray-200 overflow-hidden" style="position: fixed !important; top: 10px !important; right: 10px !important; z-index: 1000 !important; display: none;">
        <div class="p-4 border-b flex justify-between items-center">
            <h5 class="text-lg font-bold">同步日志</h5>
            <button id="close-logs-btn" class="text-gray-500 hover:text-gray-700 text-xl">
                &times;
            </button>
        </div>
        <div id="logs-content" class="p-3 overflow-y-auto h-[calc(100%-110px)]">
            加载日志中...
        </div>
        <div class="p-3 border-t">
            <button id="confirm-close-logs-btn" class="btn btn-secondary btn-sm">关闭</button>
        </div>
    </div>

    <!-- 日期范围选择器，默认隐藏 - 添加卡片样式 -->
    <div id="date-range-form" class="mb-4 p-4 border rounded bg-light hidden">
        <div class="row">
            <div class="col-md-2">
                <form id="search-form" method="get" action="/nvd/">
                    <input type="hidden" name="page" value="1">
                    <input type="hidden" name="per_page" value="20">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="搜索CVE ID、描述、厂商或产品" name="search" value="">
                        <div class="input-group-append">
                            <button class="btn btn-primary" type="submit">搜索</button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-md-3">
                <label for="start_date" class="form-label">开始日期:</label>
                <input type="date" id="start_date" class="form-control" max="">
            </div>
            <div class="col-md-3">
                <label for="end_date" class="form-label">结束日期:</label>
                <input type="date" id="end_date" class="form-control" max="">
            </div>
            <div class="col-md-6 d-flex align-items-center gap-6" style="flex-wrap: nowrap !important;">
                <button id="confirm-sync-btn" class="btn btn-primary">确认同步</button>
                <button class="btn btn-outline-secondary" id="sync-data-btn">手动同步数据</button>
                <button class="btn btn-outline-secondary" id="view-logs-btn">查看同步日志</button>
                <span id="last-update" class="btn btn-outline-info disabled ml-auto">最后更新: 加载中...</span>
            </div>
        </div>
    </div>



    <!-- 数据表格 -->
    <div class="table-responsive">
        <table id="nvd-data-table" class="table table-striped table-sm">
            <thead>
                <tr>
                    <th>CVE ID</th>
                    <th><a href="/nvd/?search=&amp;page=&amp;per_page=20&amp;sort_by=published_date&amp;sort_order=desc">发布日期 </a></th>
                    <th><a href="/nvd/?search=&amp;page=&amp;per_page=20&amp;sort_by=last_modified_date&amp;sort_order=desc">更新日期 </a></th>
                    <th>描述</th>
                    <th><a href="/nvd/?search=&amp;page=&amp;per_page=20&amp;sort_by=base_score&amp;sort_order=desc">评分 </a></th>
                    <th>严重程度</th>
                    <th>向量字符串</th>
                    <th>厂商</th>
                    <th>产品</th>
                </tr>
            </thead>
            <tbody id="nvd-data-body">
                
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11671" class="text-primary hover:underline">CVE-2025-11671</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>Uniweb/SoliPACS WebServer developed by EBM Technologies has a Missing Authentication vulnerability, ...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11672" class="text-primary hover:underline">CVE-2025-11672</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>Uniweb/SoliPACS WebServer developed by EBM Technologies has a Missing Authentication vulnerability, ...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11673" class="text-primary hover:underline">CVE-2025-11673</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>SOOP-CLM developed by PiExtract has a Hidden Functionality vulnerability, allowing privileged remote...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11674" class="text-primary hover:underline">CVE-2025-11674</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>SOOP-CLM developed by PiExtract has a Server-Side Request Forgery vulnerability, allowing privileged...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11675" class="text-primary hover:underline">CVE-2025-11675</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>Enterprise Cloud Database developed by Ragic has an Arbitrary File Upload vulnerability, allowing pr...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-9976" class="text-primary hover:underline">CVE-2025-9976</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>An OS Command Injection vulnerability affecting Station Launcher App in 3DEXPERIENCE platform from R...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-9968" class="text-primary hover:underline">CVE-2025-9968</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>&#34;A link following vulnerability exists in the UnifyScanner component of Armoury Crate. This vulnerab...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11651" class="text-primary hover:underline">CVE-2025-11651</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>A vulnerability has been found in UTT [Chinese text] 518G up to V3v3.2.7-210919-161313. This vulnera...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11652" class="text-primary hover:underline">CVE-2025-11652</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>A vulnerability was found in UTT [Chinese text] 518G up to V3v3.2.7-210919-161313. This issue affect...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11653" class="text-primary hover:underline">CVE-2025-11653</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>A vulnerability was determined in UTT HiPER 2620G up to 3.1.4. Impacted is the function strcpy of th...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11654" class="text-primary hover:underline">CVE-2025-11654</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>A vulnerability was identified in yousaf530 Inferno Online Clothing Store up to 827dd42bfbe380e8de76...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-36087" class="text-primary hover:underline">CVE-2025-36087</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>IBM Security Verify Access 10.0.0 through 10.0.9, 11.0.0, IBM Verify Identity Access Container 10.0....</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11655" class="text-primary hover:underline">CVE-2025-11655</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>A security flaw has been discovered in Total.js Flow up to 673ef9144dd25d4f4fd4fdfda5af27f230198924....</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11656" class="text-primary hover:underline">CVE-2025-11656</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>A weakness has been identified in ProjectsAndPrograms School Management System up to 6b6fae5426044f8...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11657" class="text-primary hover:underline">CVE-2025-11657</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>A security vulnerability has been detected in ProjectsAndPrograms School Management System up to 6b6...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11658" class="text-primary hover:underline">CVE-2025-11658</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>A vulnerability was detected in ProjectsAndPrograms School Management System up to 6b6fae5426044f89c...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11659" class="text-primary hover:underline">CVE-2025-11659</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>A flaw has been found in ProjectsAndPrograms School Management System up to 6b6fae5426044f89c08d0dd1...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-11660" class="text-primary hover:underline">CVE-2025-11660</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>A vulnerability has been found in ProjectsAndPrograms School Management System up to 6b6fae5426044f8...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-31994" class="text-primary hover:underline">CVE-2025-31994</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>HCL Unica Campaign 12.1.10 is vulnerable to Reflected Cross-Site Scripting (XSS) where an attacker i...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                        <tr>
                            <td><a href="/nvd/cve/CVE-2025-31996" class="text-primary hover:underline">CVE-2025-31996</a></td>
                            <td>2025-10-13</td>
                            <td>2025-10-13</td>
                            <td>HCL Unica Platform is affected by unprotected files due to improper access controls.   These files m...</td>
                            <td>-</td>
                            <td>
                                
                                    -
                                
                            </td>
                            <td></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    
                
            </tbody>
        </table>
    </div>

    <!-- 分页导航 -->
    
    <div class="mt-4 d-flex justify-content-center">
        <nav aria-label="Page navigation">
            <ul class="pagination">
                <li class="page-item disabled">
                    <a class="page-link" href="/nvd/?search=&amp;per_page=20" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                
                
                    
                        <li class="page-item active">
                            <a class="page-link" href="/nvd/?search=&amp;page=1&amp;per_page=20">1</a>
                        </li>
                    
                
                    
                        <li class="page-item ">
                            <a class="page-link" href="/nvd/?search=&amp;page=2&amp;per_page=20">2</a>
                        </li>
                    
                
                    
                        <li class="page-item ">
                            <a class="page-link" href="/nvd/?search=&amp;page=3&amp;per_page=20">3</a>
                        </li>
                    
                
                    
                        <li class="page-item disabled"><span class="page-link">...</span></li>
                    
                
                    
                        <li class="page-item ">
                            <a class="page-link" href="/nvd/?search=&amp;page=12302&amp;per_page=20">12302</a>
                        </li>
                    
                
                    
                        <li class="page-item ">
                            <a class="page-link" href="/nvd/?search=&amp;page=12303&amp;per_page=20">12303</a>
                        </li>
                    
                
                
                <li class="page-item ">
                    <a class="page-link" href="/nvd/?search=&amp;page=2&amp;per_page=20" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
    

    <!-- 每页显示条数选择器（移到页面底部） -->
    <div class="mt-4 d-flex justify-content-center">
        <div class="d-flex items-center">
            <label for="per_page" class="mr-2">每页显示:</label>
            <select id="per_page" class="form-control-sm">
                
                    <option value="20" selected>20</option>
                
                    <option value="30" >30</option>
                
                    <option value="50" >50</option>
                
                    <option value="100" >100</option>
                
            </select>
            <span class="ml-4 text-muted">共 246056 条记录</span>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 设置默认日期为最近7天
            const today = new Date();
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(today.getDate() - 7);
            
            document.getElementById('start_date').valueAsDate = sevenDaysAgo;
            document.getElementById('end_date').valueAsDate = today;
            
            // 每页显示条数变更处理
            document.getElementById('per_page').addEventListener('change', function() {
                const per_page = this.value;
                const search_form = document.getElementById('search-form');
                const per_page_input = search_form.querySelector('input[name="per_page"]');
                per_page_input.value = per_page;
                search_form.submit();
            });
            
            // 标记最后更新时间
            updateLastUpdateTime();
            
            // 手动同步数据按钮点击事件
            document.getElementById('sync-data-btn').addEventListener('click', function() {
                const dateRangeForm = document.getElementById('date-range-form');
                dateRangeForm.classList.toggle('hidden');
            });
            
            // 确认同步按钮点击事件
            document.getElementById('confirm-sync-btn').addEventListener('click', function() {
                const startDate = document.getElementById('start_date').value;
                const endDate = document.getElementById('end_date').value;
                
                if (startDate && endDate) {
                    // 显示加载状态
                    document.getElementById('last-update').textContent = '正在同步数据...';
                    
                    // 执行同步
                    window.location.href = `/nvd/sync?start_date=${startDate}&end_date=${endDate}`;
                } else {
                    alert('请选择有效的日期范围');
                }
            });
            
            // 查看日志按钮点击事件
            document.getElementById('view-logs-btn').addEventListener('click', function() {
                try {
                    // 显示悬浮窗口
                    const logsModal = document.getElementById('logs-modal');
                    logsModal.classList.remove('hidden');
                    // 设置所有关键样式确保显示
                    logsModal.style.display = 'block';
                    logsModal.style.position = 'fixed';
                    logsModal.style.top = '10px';
                    logsModal.style.right = '10px';
                    logsModal.style.zIndex = '9999';
                    
                    console.log('显示悬浮窗口 - 样式设置完成:', {
                        display: logsModal.style.display,
                        position: logsModal.style.position,
                        top: logsModal.style.top,
                        right: logsModal.style.right,
                        zIndex: logsModal.style.zIndex
                    });
                    
                    // 加载日志内容
                    loadLogs();
                } catch (error) {
                    console.error('打开日志窗口失败:', error);
                    alert('打开日志窗口失败，请刷新页面重试');
                }
            });
            
            // 关闭日志窗口按钮点击事件
            document.getElementById('close-logs-btn').addEventListener('click', function() {
                try {
                    const logsModal = document.getElementById('logs-modal');
                    if (logsModal) {
                        console.log('关闭日志窗口 - X按钮');
                        // 确保添加hidden类
                        logsModal.classList.add('hidden');
                        // 同时设置display: none作为后备
                        logsModal.style.display = 'none';
                    }
                } catch (error) {
                    console.error('关闭日志窗口失败:', error);
                }
            });
            
            // 确认关闭日志窗口按钮点击事件
            document.getElementById('confirm-close-logs-btn').addEventListener('click', function() {
                try {
                    const logsModal = document.getElementById('logs-modal');
                    if (logsModal) {
                        console.log('关闭日志窗口 - 关闭按钮');
                        // 确保添加hidden类
                        logsModal.classList.add('hidden');
                        // 同时设置display: none作为后备
                        logsModal.style.display = 'none';
                    }
                } catch (error) {
                    console.error('关闭日志窗口失败:', error);
                }
            });
            
            // 每10秒自动更新数据
            setInterval(function() {
                // 更新最后更新时间显示
                updateLastUpdateTime();
                
                // 只有在首页时才自动刷新数据，避免分页后也刷新
                if (window.location.href.includes('page=1') || !window.location.href.includes('page=')) {
                    // 刷新表格数据
                    refreshTableData();
                }
            }, 10000);
        });
        
        // 更新最后更新时间显示
        function updateLastUpdateTime() {
            const lastUpdateElement = document.getElementById('last-update');
            const now = new Date();
            lastUpdateElement.textContent = `最后更新: ${now.toLocaleString()}`;
        }
        
        // 刷新表格数据
        function refreshTableData() {
            // 这里应该通过AJAX请求获取最新数据，然后更新表格内容
            console.log('刷新数据：', new Date().toLocaleString());
            
            // 实际应用中应该调用API获取数据，然后更新表格
            // 获取当前的搜索参数
            const searchParams = new URLSearchParams(window.location.search);
            const searchQuery = searchParams.get('search') || '';
            const page = searchParams.get('page') || 1;
            const perPage = searchParams.get('per_page') || 20;
            const sortBy = searchParams.get('sort_by') || 'published_date';
            const sortOrder = searchParams.get('sort_order') || 'desc';
            
            // 构建API请求URL
            const baseUrl = window.location.origin + '/nvd/api/data';
            const apiUrl = baseUrl + '?search=' + encodeURIComponent(searchQuery) + '&page=' + page + '&per_page=' + perPage + '&sort_by=' + sortBy + '&sort_order=' + sortOrder;
            
            // 发送请求获取数据
            fetch(apiUrl)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('网络响应错误: ' + response.status);
                    }
                    return response.json();
                })
                .then(function(data) {
                    if (data && data.data) {
                        // 更新表格内容
                        updateTableContent(data.data);
                    } else {
                        console.error('数据格式不正确');
                    }
                })
                .catch(function(error) {
                    console.error('获取数据失败:', error);
                });
        }
        
        // 更新表格内容
        function updateTableContent(data) {
            const tableBody = document.getElementById('nvd-data-body');
            
            if (data && data.length > 0) {
                // 清空表格
                tableBody.innerHTML = '';
                
                // 添加新数据行
                for (let i = 0; i < data.length; i++) {
                    const item = data[i];
                    const row = document.createElement('tr');
                    
                    // 构建严重性标签
                    let severityBadge = '-';
                    if (item.base_severity) {
                        let badgeClass = '';
                        switch (item.base_severity) {
                            case 'CRITICAL': badgeClass = 'bg-danger'; break;
                            case 'HIGH': badgeClass = 'bg-warning text-dark'; break;
                            case 'MEDIUM': badgeClass = 'bg-primary'; break;
                            case 'LOW': badgeClass = 'bg-secondary'; break;
                            default: badgeClass = 'bg-info'; break;
                        }
                        severityBadge = '<span class="badge ' + badgeClass + '">' + item.base_severity + '</span>';
                    }
                    
                    // 设置行内容
                    row.innerHTML = 
                        '<td><a href="/nvd/cve/' + item.cve_id + '" class="text-primary hover:underline">' + item.cve_id + '</a></td>' +
                        '<td>' + item.published_date + '</td>' +
                        '<td>' + item.last_modified_date + '</td>' +
                        '<td>' + (item.description ? (item.description.substring(0, 100) + (item.description.length > 100 ? '...' : '')) : '-') + '</td>' +
                        '<td>' + (item.base_score || '-') + '</td>' +
                        '<td>' + severityBadge + '</td>' +
                        '<td>' + (item.vector_string ? (item.vector_string.substring(0, 30) + (item.vector_string.length > 30 ? '...' : '')) : '-') + '</td>' +
                        '<td>' + (item.vendor || '-') + '</td>' +
                        '<td>' + (item.product || '-') + '</td>';
                    
                    tableBody.appendChild(row);
                }
            }
        }
        
        // 加载同步日志
        function loadLogs() {
            const logsContent = document.getElementById('logs-content');
            logsContent.innerHTML = '<div class="text-center text-muted">加载日志中...</div>';
            
            // 从服务器获取日志内容
            const baseUrl = window.location.origin + '/nvd/api/logs';
            fetch(baseUrl)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('网络响应错误: ' + response.status);
                    }
                    return response.json();
                })
                .then(function(logs) {
                    if (logs && logs.length > 0) {
                        let logsHTML = '<ul class="list-unstyled">';
                        for (let i = 0; i < logs.length; i++) {
                            const log = logs[i];
                            const actionType = log.action_type === 'auto' ? '自动同步' : '手动同步';
                            const actionClass = log.action_type === 'auto' ? 'badge-secondary' : 'badge-primary';
                            const dateRange = log.start_date && log.end_date 
                                ? ' <span class="text-muted">(</span><span class="text-info">' + log.start_date + '</span> <span class="text-muted">至</span> <span class="text-info">' + log.end_date + '</span><span class="text-muted">)</span>' 
                                : '';
                            
                            logsHTML += '<li class="p-4 bg-light rounded border border-gray-200 mb-4 shadow-sm">';
                            logsHTML += '<div class="text-sm text-gray-500 mb-2">' + log.timestamp + '</div>';
                            logsHTML += '<div class="flex flex-wrap items-center gap-3">';
                            logsHTML += '<span class="badge ' + actionClass + ' px-3 py-1">' + actionType + '</span>';
                            logsHTML += '<span class="text-gray-800">完成，新增 <span class="font-bold text-primary">' + log.count + '</span> 条记录</span>';
                            logsHTML += dateRange;
                            logsHTML += '</div>';
                            logsHTML += '</li>';
                        }
                        logsHTML += '</ul>';
                        logsContent.innerHTML = logsHTML;
                    } else {
                        logsContent.innerHTML = '<div class="text-center text-muted py-4">暂无同步日志</div>';
                    }
                })
                .catch(function(error) {
                    console.error('获取日志失败:', error);
                    logsContent.innerHTML = '<div class="text-center text-danger py-4">获取日志失败，请稍后重试</div>';
                });
        }
    </script>

            </main>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Feather Icons -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js"></script>
    <script>
        // 初始化图标
        feather.replace();
    </script>
</body>
</html>